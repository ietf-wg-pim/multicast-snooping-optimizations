---
coding: utf-8

title: Multicast Snooping Optimizations
abbrev: Multicast Snooping Optimizations
docname: draft-karstens-pim-multicast-snooping-optimizations-00
updates: 4541
category: std
submissionType: IETF

standalone: yes
pi: [toc, sortrefs, symrefs, comments]

ipr: trust200902
area: Routing
wg: pim
kw: multicast snooping

author: 
  -
    ins: N. Karstens
    name: Nate Karstens
    org: Garmin International
    email: nate.karstens@garmin.com

  -
    ins: Z. Zhang
    name: Zhaohui Zhang
    org: Juniper Networks
    email: zzhang@juniper.net
  
  -
    ins: L. Giuliano
    name: Lenny Giuliano
    org: Juniper Networks
    email: lenny@juniper.net

  -
    ins: N. Ashik
    name: Naveen Ashik
    org: Juniper Networks
    email: nashik@juniper.net
  
  -
    ins: J. Huang
    name: Joseph Huang
    org: Garmin International
    email: joseph.huang@garmin.com

--- abstract

TODO

--- middle

# Introduction

Considerations for the operation of IGMP and MLD snooping switches are described in {{!RFC4541}}. In the intervening years since publication, industry has gained experience with deploying this technology and have identified areas of improvement on the original document, including how traffic distribution can be optimized for certain types of networks.

One area of improvement is that there appears to be a gap in the control path forwarding rules outlined in {{!RFC4541}} section 2.1.1. Forwarding rules are defined for switch ports attached to multicast routers and switch ports attached to hosts, but switch ports attached to other switches are not mentioned, leaving the operation of these ports open to interpretation.

The authors may have purposefully limited consideration to networks with only a single switch, though this is not explicitly stated. In one sense, a network with a hierarchy of switches may be modeled as a single switch (in other words, the fact that multiple switches are being used would be transparent to any host or multicast router attached to the network). One side-effect of this approach is that it obscures how the network distributes traffic between multiple switches.

This router-centric view of multicast traffic distribution is likely rooted in the nature of the IGMP and MLD protocols, whose stated purpose is to communicate group membership (that is, the fact that a host would like to receive a given stream of multicast data) to a multicast router. Two types of networks would benefit from a closer examination of how traffic is distributed between multiple switches: 1) networks that do not contain a multicast router and 2) networks that contain a multicast router, but have a significant volume of multicast data that does not need to be routed outside of the local network.

The following diagram depicts an example network that can be used to illustrate the point:

                            /------\
                            |      |
                   //=======|  S2  |=======\\
                   ||       |      |       ||
                   mr       \------/       ||
                /------\                /------\
                |      |                |      |
       //=======|  S1  |=======\\       |  H4  |
       ||       |      |       ||       |      |
       ||       \------/       ||       \------/
       ||          ||          ||
       ||          ||          ||
    /------\    /------\    /------\
    |      |    |      |    |      |
    |  H1  |    |  H2  |    |  H3  |
    |      |    |      |    |      |
    \------/    \------/    \------/

S1 has designated its port connected to S2 as a multicast router port.

Suppose the example network contains two mulicast streams:

* Stream 1 generated by H1 and consumed by H3
* Stream 2 generated by H2 and consumed by H4

The problem is that Stream 1 is forwarded from S1 to S2 even though there are no consumers of this data. This is due to the following data forwarding rule in {{!RFC4541}} section 2.1.2:

> Packets with a destination IP address outside 224.0.0.X which are not IGMP should be forwarded according to group-based port membership tables and must also be forwarded on router ports.

While it would be tempting to ignore this rule so that Stream 1 is no longer forwarded, this would also prevent Stream 2 from reaching H4. This is because of the following IGMP forwarding rule in {{!RFC4541}} section 2.1.1:

> A snooping switch should forward IGMP Membership Reports only to those ports where multicast routers are attached.

This rule prevents S2 from forwarding the Membership Report from H4 to S1, so S1 does not mark the port connected to S2 as a member of the multicast group for Stream 2.

{{!RFC4541}} indicates that this rule is meant to prevent a host running IGMPv1 or IGMPv2 (or MLDv1) from suppressing its Membership Report for that multicast group. While it would be tempting to require all hosts on the network to run IGMPv3 (or MLDv2), this is not possible on the networks targeted for deployment of this solution.

The next logical step in this direction would be to require multicast snooping switches to use some method to identify the nature of the device connected to each port (switch or host, IGMP/MLD version, etc.). This information would then be used to help control the distribution of Membership Reports.

However, this document uses a different approach, electing instead to use General Query messages to ensure membership information is distributed to all multicast snooping switches on the network. This solution is less complicated than methods that focus on Membership Reports, which reduces the likelihood for error. In addition, compatibility between different versions of IGMP and MLD are less of a concern because each protocol's Query messages are compatible with earlier versions of the protocol.

## Terminology

This document refers to IGMP snooping and MLD snooping collectively as "multicast snooping".

TODO: if there are notable differences then mention something like "except where there are notable differences".

# Security Considerations

To be added.
  
# IANA Considerations

This document does not have any IANA assignments/requests.

# Acknowledgements

The authors would like to recognize the following individuals for their contributions to this research:

* David Vandewalle<br />
  Garmin International
* Princy Elizabeth<br />
  Juniper Networks